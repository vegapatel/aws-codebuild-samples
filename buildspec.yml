version: 0.2

phases:
  install:
    runtime-versions:
      nodejs: 10
    commands:
      - npm install
  pre_build:
    commands:
      - echo Entered the pre_build phase...
      - yum install git -y
      - echo 'echo f322fb2dd7c072679b4f4f81e31431f496d5246a' > $PWD/.git-askpass
      - chmod -R 0777 $PWD/.git-askpass
      - export MY_GIT_TOKEN=f322fb2dd7c072679b4f4f81e31431f496d5246a
      - export GIT_ASKPASS=$PWD/.git-askpass
      - git clone --recursive https://f322fb2dd7c072679b4f4f81e31431f496d5246a@github.com/vegapatel/aws-codebuild-samples.git
      - ls $PWD/aws-codebuild-samples
    finally:
      - echo This always runs even if the login command fails 
  build:
    commands:
      - npm test
artifacts:
  files:
    - '**/*'
